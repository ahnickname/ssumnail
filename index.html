<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì›¹ëƒ¥ì´ì˜ ì¸ë„¤ì¼ ë©”ì´ì»¤ (AI Powered)</title>
    <style>
        :root { --bg-color: #1a1a1a; --point-color: #ff9f43; --text-color: #fff; }
        body { margin: 0; padding: 20px; font-family: 'Pretendard', sans-serif; background: var(--bg-color); color: var(--text-color); display: flex; flex-direction: column; align-items: center; }
        h1 { color: var(--point-color); margin-bottom: 10px; }
        .controls { background: #333; padding: 20px; border-radius: 10px; margin-bottom: 20px; width: 100%; max-width: 800px; display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; }
        input[type="file"], input[type="text"] { padding: 10px; border-radius: 5px; border: none; }
        button { padding: 10px 20px; background: var(--point-color); color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        button:hover { opacity: 0.8; }
        #canvas-container { box-shadow: 0 0 20px rgba(0,0,0,0.5); border: 2px solid #555; }
        .loading { display: none; margin-top: 10px; color: #ff9f43; font-weight: bold; font-size: 1.1em; }
        
        @media (max-width: 600px) { .controls { flex-direction: column; } }
    </style>
    <script src="https://unpkg.com/fabric@5.3.0/dist/fabric.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@imgly/background-removal@1.0.4/dist/imgly-background-removal.min.js"></script>
</head>
<body>

    <h1>ğŸ± ì›¹ëƒ¥ì´ ì¸ë„¤ì¼ ë©”ì´ì»¤ V2</h1>
    <p>ì´ë¯¸ì§€ë¥¼ ì˜¬ë¦¬ë©´ AIê°€ ë°°ê²½ì„ ì§€ì›Œì¤ë‹ˆë‹¤! (ì¡°ê¸ˆë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”)</p>

    <div class="controls">
        <input type="file" id="imgLoader" multiple accept="image/*">
        <input type="text" id="textInput" placeholder="ë¬¸êµ¬ ì…ë ¥ (ì˜ˆ: ì¶©ê²© ì‹¤í™”!)">
        <button onclick="addText()">ê¸€ì”¨ ë„£ê¸°</button>
        <button onclick="downloadImage()">ğŸ’¾ ì €ì¥í•˜ê¸°</button>
        <button onclick="deleteObject()" style="background:#ff4343;">ğŸ—‘ï¸ ì„ íƒ ì‚­ì œ</button>
    </div>
    
    <div class="loading" id="loadingMsg">ğŸ¾ AIê°€ ë‘ë‡Œë¥¼ ê°€ë™ ì¤‘ì…ë‹ˆë‹¤... (10~20ì´ˆ ì†Œìš”)</div>

    <div id="canvas-container">
        <canvas id="c" width="1280" height="720"></canvas>
    </div>

    <script>
        const canvas = new fabric.Canvas('c');
        canvas.backgroundColor = '#222';
        canvas.renderAll();

        document.getElementById('imgLoader').addEventListener('change', async function(e) {
            const files = e.target.files;
            if (!files.length) return;

            const loadingMsg = document.getElementById('loadingMsg');
            loadingMsg.style.display = 'block';

            for (let file of files) {
                try {
                    console.log(`Processing: ${file.name}`);
                    loadingMsg.innerText = `â³ ${file.name} ë°°ê²½ ì§€ìš°ëŠ” ì¤‘...`;
                    
                    // [í•µì‹¬ ìˆ˜ì •] AI ëª¨ë¸ íŒŒì¼ ìœ„ì¹˜ë¥¼ ê°•ì œë¡œ ì§€ì •í•´ì¤ë‹ˆë‹¤.
                    const config = {
                        publicPath: "https://cdn.jsdelivr.net/npm/@imgly/background-removal-data@1.0.4/dist/"
                    };

                    const blob = await imglyRemoveBackground(file, config);
                    const url = URL.createObjectURL(blob);

                    fabric.Image.fromURL(url, function(img) {
                        if (img.width > 500) img.scaleToWidth(400);
                        img.set({
                            left: canvas.width / 2 - 200 + (Math.random() * 50),
                            top: canvas.height / 2 - 200 + (Math.random() * 50)
                        });
                        canvas.add(img);
                        canvas.setActiveObject(img);
                    });
                } catch (error) {
                    console.error(error);
                    alert(`ì˜¤ë¥˜ ë°œìƒ: ${file.name}\n(íŒŒì¼ ì´ë¦„ì´ ì˜ì–´ì¸ì§€ í™•ì¸í•´ì£¼ì‹œê±°ë‚˜, ë‹¤ë¥¸ ì´ë¯¸ì§€ë¥¼ ì¨ë³´ì„¸ìš”!)`);
                }
            }
            loadingMsg.style.display = 'none';
            loadingMsg.innerText = "ì™„ë£Œ!";
        });

        function addText() {
            const textVal = document.getElementById('textInput').value;
            if (!textVal) return;
            const text = new fabric.Text(textVal, {
                left: 100, top: 100, fontFamily: 'sans-serif', fontSize: 80,
                fill: 'yellow', stroke: 'black', strokeWidth: 2, fontWeight: 'bold'
            });
            canvas.add(text);
            canvas.setActiveObject(text);
        }

        function downloadImage() {
            const dataURL = canvas.toDataURL({ format: 'png', quality: 1.0 });
            const link = document.createElement('a');
            link.download = 'thumbnail.png';
            link.href = dataURL;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function deleteObject() {
            const activeObjects = canvas.getActiveObjects();
            if (activeObjects.length) {
                canvas.discardActiveObject();
                activeObjects.forEach((obj) => canvas.remove(obj));
            }
        }
        
        // í‚¤ë³´ë“œ Delete í‚¤ ì§€ì›
        window.addEventListener('keydown', (e) => { if(e.key === 'Delete') deleteObject(); });
    </script>
</body>
</html>
