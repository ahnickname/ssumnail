<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì›¹ëƒ¥ì´ì˜ ì¸ë„¤ì¼ ë©”ì´ì»¤ (AI Powered)</title>
    <style>
        :root { --bg-color: #1a1a1a; --point-color: #ff9f43; --text-color: #fff; }
        body { margin: 0; padding: 20px; font-family: 'Pretendard', sans-serif; background: var(--bg-color); color: var(--text-color); display: flex; flex-direction: column; align-items: center; }
        h1 { color: var(--point-color); margin-bottom: 10px; }
        .controls { background: #333; padding: 20px; border-radius: 10px; margin-bottom: 20px; width: 100%; max-width: 800px; display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; }
        input[type="file"], input[type="text"] { padding: 10px; border-radius: 5px; border: none; }
        button { padding: 10px 20px; background: var(--point-color); color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        button:hover { opacity: 0.8; }
        #canvas-container { box-shadow: 0 0 20px rgba(0,0,0,0.5); border: 2px solid #555; }
        .loading { display: none; margin-top: 10px; color: #aaa; font-size: 0.9em; }
        
        /* ëª¨ë°”ì¼ ëŒ€ì‘ */
        @media (max-width: 600px) { .controls { flex-direction: column; } }
    </style>
    <script src="https://unpkg.com/fabric@5.3.0/dist/fabric.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@imgly/background-removal@1.0.4/dist/imgly-background-removal.min.js"></script>
</head>
<body>

    <h1>ğŸ± ì›¹ëƒ¥ì´ ì¸ë„¤ì¼ ë©”ì´ì»¤</h1>
    <p>ì´ë¯¸ì§€ë¥¼ ì˜¬ë¦¬ë©´ AIê°€ ìë™ìœ¼ë¡œ ë°°ê²½ì„ ì§€ì›Œì¤ë‹ˆë‹¤!</p>

    <div class="controls">
        <input type="file" id="imgLoader" multiple accept="image/*">
        <input type="text" id="textInput" placeholder="ì¸ë„¤ì¼ ë¬¸êµ¬ ì…ë ¥ (ì˜ˆ: ì¶©ê²© ì‹¤í™”!)">
        <button onclick="addText()">ê¸€ì”¨ ë„£ê¸°</button>
        <button onclick="downloadImage()">ğŸ’¾ ì €ì¥í•˜ê¸°</button>
    </div>
    
    <div class="loading" id="loadingMsg">AIê°€ ì—´ì‹¬íˆ ëˆ„ë¼ë¥¼ ë”°ê³  ìˆì–´ìš”... (ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”!) ğŸ¾</div>

    <div id="canvas-container">
        <canvas id="c" width="1280" height="720"></canvas>
    </div>

    <script>
        // 1. ìº”ë²„ìŠ¤ ì´ˆê¸°í™” (ìœ íŠœë¸Œ ì¸ë„¤ì¼ ì‚¬ì´ì¦ˆ 1280x720)
        const canvas = new fabric.Canvas('c');
        canvas.backgroundColor = '#222'; // ê¸°ë³¸ ë°°ê²½ìƒ‰
        canvas.renderAll();

        // 2. ì´ë¯¸ì§€ ì—…ë¡œë“œ ë° AI ë°°ê²½ ì œê±° ì²˜ë¦¬
        document.getElementById('imgLoader').addEventListener('change', async function(e) {
            const files = e.target.files;
            if (!files.length) return;

            const loadingMsg = document.getElementById('loadingMsg');
            loadingMsg.style.display = 'block';

            for (let file of files) {
                try {
                    console.log(`Processing: ${file.name}`);
                    // @imgly ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ë°°ê²½ ì œê±° (ë¸Œë¼ìš°ì €ì—ì„œ ë°”ë¡œ ì‹¤í–‰)
                    const blob = await imglyRemoveBackground(file);
                    const url = URL.createObjectURL(blob);

                    fabric.Image.fromURL(url, function(img) {
                        // ì´ë¯¸ì§€ í¬ê¸° ì¡°ì • (ë„ˆë¬´ í¬ë©´ ì¤„ì„)
                        if (img.width > 500) {
                            img.scaleToWidth(400);
                        }
                        // ìº”ë²„ìŠ¤ ì¤‘ì•™ì— ë°°ì¹˜
                        img.set({
                            left: canvas.width / 2 - 200 + (Math.random() * 50),
                            top: canvas.height / 2 - 200 + (Math.random() * 50)
                        });
                        canvas.add(img);
                        canvas.setActiveObject(img);
                    });
                } catch (error) {
                    console.error("ë°°ê²½ ì œê±° ì‹¤íŒ¨:", error);
                    alert(`${file.name} ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš” ã… ã… `);
                }
            }
            loadingMsg.style.display = 'none';
        });

        // 3. í…ìŠ¤íŠ¸ ì¶”ê°€ ê¸°ëŠ¥
        function addText() {
            const textVal = document.getElementById('textInput').value;
            if (!textVal) return;

            const text = new fabric.Text(textVal, {
                left: 100,
                top: 100,
                fontFamily: 'Pretendard',
                fontSize: 80,
                fill: 'yellow',
                stroke: 'black',
                strokeWidth: 2,
                fontWeight: 'bold',
                shadow: new fabric.Shadow({ color: "rgba(0,0,0,0.8)", blur: 10, offsetX: 5, offsetY: 5 })
            });
            canvas.add(text);
            canvas.setActiveObject(text);
        }

        // 4. ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥
        function downloadImage() {
            const dataURL = canvas.toDataURL({
                format: 'png',
                quality: 1.0
            });
            const link = document.createElement('a');
            link.download = 'thumbnail.png';
            link.href = dataURL;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // í‚¤ë³´ë“œ Delete í‚¤ë¡œ ê°ì²´ ì‚­ì œ
        window.addEventListener('keydown', function(e) {
            if(e.key === 'Delete') {
                const activeObjects = canvas.getActiveObjects();
                if (activeObjects.length) {
                    canvas.discardActiveObject();
                    activeObjects.forEach(function(obj) {
                        canvas.remove(obj);
                    });
                }
            }
        });
    </script>
</body>
</html>