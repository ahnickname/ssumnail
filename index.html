<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¹—ì†ì˜ ì§„ì‹¤ - ë°©íƒˆì¶œ</title>
    <style>
        /* [ìŠ¤íƒ€ì¼ ì„¤ì •] ê²Œì„ì˜ ë¶„ìœ„ê¸°ë¥¼ ë‹´ë‹¹í•©ë‹ˆë‹¤ */
        :root {
            --bg-color: #1a1a1a;
            --text-color: #e0e0e0;
            --accent-color: #d32f2f; /* í•ë¹› ê°•ì¡°ìƒ‰ */
            --panel-bg: rgba(0, 0, 0, 0.8);
        }

        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Courier New', Courier, monospace; /* íƒ€ìê¸° ëŠë‚Œ */
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        /* ë¹„ ë‚´ë¦¬ëŠ” ë°°ê²½ ìº”ë²„ìŠ¤ */
        #rain-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            pointer-events: none; /* í´ë¦­ í†µê³¼ */
        }

        /* ê²Œì„ ì»¨í…Œì´ë„ˆ */
        #game-container {
            position: relative;
            width: 900px;
            height: 600px;
            background-size: cover;
            background-position: center;
            border: 2px solid #555;
            box-shadow: 0 0 20px rgba(0,0,0,0.8);
            z-index: 10;
            display: flex;
            overflow: hidden;
        }

        /* ë©”ì¸ í™”ë©´ (ë°©) */
        #main-view {
            flex: 3;
            position: relative;
            background-color: #222;
            transition: background-image 0.5s ease;
        }

        /* ì˜¤ë¥¸ìª½ ì¸ë²¤í† ë¦¬ (ê°€ë°©) */
        #inventory-sidebar {
            flex: 1;
            background-color: #111;
            border-left: 2px solid #444;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #inventory-title {
            font-size: 18px;
            border-bottom: 1px solid #666;
            width: 100%;
            text-align: center;
            padding-bottom: 10px;
            margin-bottom: 20px;
            color: #aaa;
        }

        .inventory-slot {
            width: 60px;
            height: 60px;
            background-color: #333;
            margin-bottom: 10px;
            border: 1px solid #555;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }
        
        .inventory-slot img {
            width: 80%;
            height: 80%;
        }

        /* í•˜ë‹¨ ëŒ€í™”ì°½ */
        #dialog-box {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 75%; /* ì¸ë²¤í† ë¦¬ ì œì™¸ ë„ˆë¹„ */
            height: 120px;
            background: rgba(0, 0, 0, 0.85);
            border-top: 2px solid #444;
            padding: 15px;
            box-sizing: border-box;
            font-size: 16px;
            line-height: 1.5;
        }

        /* ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ (< >) */
        .nav-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            font-size: 40px;
            color: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            user-select: none;
            transition: color 0.3s;
            z-index: 20;
        }
        .nav-btn:hover { color: white; }
        #btn-left { left: 20px; }
        #btn-right { right: 26%; } /* ì¸ë²¤í† ë¦¬ ê³ ë ¤ */

        /* ì•„ì´í…œ (í´ë¦­ ê°€ëŠ¥ ìš”ì†Œ) */
        .clue-item {
            position: absolute;
            cursor: pointer;
            filter: drop-shadow(0 0 5px white);
            transition: transform 0.2s;
        }
        .clue-item:hover { transform: scale(1.1); }

        /* íŒì—… ëª¨ë‹¬ì°½ */
        #modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }

        #popup-window {
            background: #222;
            border: 2px solid var(--accent-color);
            padding: 20px;
            width: 300px;
            text-align: center;
            color: white;
            position: relative;
            box-shadow: 0 0 15px var(--accent-color);
        }

        #popup-close {
            position: absolute;
            top: 5px;
            right: 10px;
            cursor: pointer;
            font-size: 20px;
            color: #888;
        }
        #popup-close:hover { color: white; }

        #popup-img {
            max-width: 100px;
            margin: 10px 0;
        }

    </style>
</head>
<body>

    <canvas id="rain-canvas"></canvas>

    <div id="game-container">
        <div id="main-view">
            <div id="btn-left" class="nav-btn" onclick="moveRoom(-1)">&lt;</div>
            <div id="btn-right" class="nav-btn" onclick="moveRoom(1)">&gt;</div>
            
            <div id="room-content"></div>

            <div id="dialog-box">
                ê²Œì„ì„ ì‹œì‘í•©ë‹ˆë‹¤. íƒì •ì´ ë˜ì–´ ì‚¬ê±´ì„ í•´ê²°í•˜ì„¸ìš”.
            </div>
        </div>

        <div id="inventory-sidebar">
            <div id="inventory-title">ì¦ê±°ë¬¼ ê°€ë°©</div>
            <div id="inventory-list">
                </div>
        </div>

        <div id="modal-overlay">
            <div id="popup-window">
                <span id="popup-close" onclick="closePopup()">X</span>
                <h3 id="popup-title">ì•„ì´í…œ íšë“!</h3>
                <img id="popup-img" src="" alt="item">
                <p id="popup-desc">ì„¤ëª…ì´ ë“¤ì–´ê°‘ë‹ˆë‹¤.</p>
            </div>
        </div>
    </div>

    <script>
        // [ê²Œì„ ë°ì´í„° ì„¤ì •]
        const rooms = [
            {
                name: "ê±°ì‹¤ (ì‚¬ê±´ í˜„ì¥)",
                // ì‹¤ì œ ì´ë¯¸ì§€ URLì„ ë„£ìœ¼ì„¸ìš”. ì§€ê¸ˆì€ ìƒ‰ìƒìœ¼ë¡œ ëŒ€ì²´í•©ë‹ˆë‹¤.
                background: "linear-gradient(to bottom, #2c3e50, #000000)", 
                text: "í”¼í•´ìê°€ ì“°ëŸ¬ì ¸ ìˆëŠ” ê±°ì‹¤ì´ë‹¤. ì°½ë°–ì— ë¹„ê°€ ì„¸ì°¨ê²Œ ë‚´ë¦°ë‹¤. (ì˜¤ë¥¸ìª½ìœ¼ë¡œ ì´ë™ ê°€ëŠ¥)",
                items: [
                    { id: "note", name: "êµ¬ê²¨ì§„ ìª½ì§€", x: 200, y: 400, icon: "ğŸ“„", desc: "'ë‹¥í„° í™”ì´íŠ¸ë¥¼ ë¯¿ì§€ ë§ˆ...'ë¼ê³  ì í˜€ìˆë‹¤." },
                    { id: "poison", name: "ì˜ë¬¸ì˜ ì•½ë³‘", x: 500, y: 450, icon: "ğŸ§ª", desc: "ë°”ë‹¥ì— êµ´ëŸ¬ë‹¤ë‹ˆëŠ” ë¹ˆ ì•½ë³‘ì´ë‹¤." }
                ]
            },
            {
                name: "ì£¼ë°©",
                background: "linear-gradient(to bottom, #4e4376, #2b5876)",
                text: "ì°¨ê°€ìš´ ê³µê¸°ê°€ ê°ë„ëŠ” ì£¼ë°©ì´ë‹¤. ì‹íƒ ìœ„ì— ë¬´ì–¸ê°€ ìˆë‹¤.",
                items: [
                    { id: "knife", name: "ë…¹ìŠ¨ ì—´ì‡ ", x: 300, y: 350, icon: "ğŸ”‘", desc: "ì„œì¬ë¥¼ ì—´ ìˆ˜ ìˆì„ ê²ƒ ê°™ì€ ì—´ì‡ ë‹¤." }
                ]
            },
            {
                name: "ì„œì¬ (ì ê¹€)",
                background: "linear-gradient(to bottom, #434343, #000000)",
                text: "ì„œì¬ ë¬¸ì€ êµ³ê²Œ ë‹«í˜€ìˆë‹¤. ì—´ì‡ ê°€ í•„ìš”í•˜ë‹¤.",
                items: [],
                locked: true,
                keyId: "knife" // ì´ ì•„ì´í…œì´ ìˆì–´ì•¼ ì—´ë¦¼
            }
        ];

        let currentRoomIndex = 0;
        let inventory = [];

        // [ì´ˆê¸°í™”]
        window.onload = function() {
            initRain();
            loadRoom(0);
        };

        // [ë°© ì´ë™ ë¡œì§]
        function moveRoom(direction) {
            let nextIndex = currentRoomIndex + direction;

            // ìˆœí™˜ êµ¬ì¡°ê°€ ì•„ë‹ˆë¼ ëì— ë‹¿ìœ¼ë©´ ë©ˆì¶”ê²Œ í•˜ë ¤ë©´:
            if (nextIndex < 0) {
                updateDialog("ë” ì´ìƒ ê°ˆ ê³³ì´ ì—†ë‹¤.");
                return;
            }
            if (nextIndex >= rooms.length) {
                updateDialog("ë³µë„ ëì´ë‹¤.");
                return;
            }

            // ì ê¸´ ë°© ì²´í¬
            if (rooms[nextIndex].locked) {
                const hasKey = inventory.includes(rooms[nextIndex].keyId);
                if (!hasKey) {
                    updateDialog("ë¬¸ì´ ì ê²¨ìˆë‹¤. ì—´ì‡ ê°€ í•„ìš”í•´ ë³´ì¸ë‹¤.");
                    return;
                } else {
                    updateDialog("ì—´ì‡ ë¡œ ë¬¸ì„ ì—´ì—ˆë‹¤!");
                    rooms[nextIndex].locked = false; // ì˜êµ¬ í•´ì œ
                }
            }

            currentRoomIndex = nextIndex;
            loadRoom(currentRoomIndex);
        }

        // [ë°© ë¡œë“œ ë¡œì§]
        function loadRoom(index) {
            const room = rooms[index];
            const view = document.getElementById("main-view");
            const content = document.getElementById("room-content");
            
            // ë°°ê²½ ë³€ê²½
            view.style.background = room.background;
            
            // ëŒ€ì‚¬ ë³€ê²½
            updateDialog(room.text);

            // ì•„ì´í…œ ë°°ì¹˜
            content.innerHTML = ""; // ê¸°ì¡´ ì•„ì´í…œ ì œê±°
            room.items.forEach((item, i) => {
                if (!inventory.includes(item.id)) { // ì•„ì§ ì•ˆ ì£¼ìš´ ì•„ì´í…œë§Œ í‘œì‹œ
                    const el = document.createElement("div");
                    el.className = "clue-item";
                    el.innerHTML = item.icon; // ì´ëª¨ì§€ ëŒ€ì‹  ì´ë¯¸ì§€ íƒœê·¸ ì‚¬ìš© ê°€ëŠ¥
                    el.style.fontSize = "40px";
                    el.style.left = item.x + "px";
                    el.style.top = item.y + "px";
                    el.onclick = () => getItem(item, index, i);
                    content.appendChild(el);
                }
            });
        }

        // [ì•„ì´í…œ íšë“]
        function getItem(item, roomIdx, itemIdx) {
            inventory.push(item.id);
            
            // í™”ë©´ì—ì„œ ì œê±°
            loadRoom(roomIdx);

            // ì¸ë²¤í† ë¦¬ì— ì¶”ê°€
            const slot = document.createElement("div");
            slot.className = "inventory-slot";
            slot.innerHTML = item.icon;
            slot.title = item.name;
            slot.onclick = () => updateDialog(item.name + ": " + item.desc);
            document.getElementById("inventory-list").appendChild(slot);

            // íŒì—… ë„ìš°ê¸°
            showPopup(item);
        }

        // [íŒì—… ë¡œì§]
        function showPopup(item) {
            document.getElementById("popup-title").innerText = item.name + " íšë“!";
            document.getElementById("popup-desc").innerText = item.desc;
            // ì‹¤ì œ ì´ë¯¸ì§€ê°€ ìˆë‹¤ë©´ src ë³€ê²½
            // document.getElementById("popup-img").src = "ì´ë¯¸ì§€ê²½ë¡œ"; 
            document.getElementById("popup-img").style.display = "none"; // ì´ë¯¸ì§€ ì—†ì–´ì„œ ìˆ¨ê¹€
            document.getElementById("modal-overlay").style.display = "flex";
        }

        function closePopup() {
            document.getElementById("modal-overlay").style.display = "none";
        }

        function updateDialog(text) {
            document.getElementById("dialog-box").innerText = text;
        }

        // [ë¹„ ë‚´ë¦¬ëŠ” íš¨ê³¼ - Canvas Animation]
        function initRain() {
            const canvas = document.getElementById('rain-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            const drops = [];
            const count = 100; // ë¹—ë°©ìš¸ ê°œìˆ˜

            for(let i=0; i<count; i++) {
                drops.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    length: Math.random() * 20 + 10,
                    speed: Math.random() * 10 + 5
                });
            }

            function draw() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.strokeStyle = 'rgba(174, 194, 224, 0.5)';
                ctx.lineWidth = 1;
                ctx.beginPath();

                for(let i=0; i<count; i++) {
                    const d = drops[i];
                    ctx.moveTo(d.x, d.y);
                    ctx.lineTo(d.x, d.y + d.length);
                    
                    d.y += d.speed;
                    if (d.y > canvas.height) {
                        d.y = -d.length;
                        d.x = Math.random() * canvas.width;
                    }
                }
                ctx.stroke();
                requestAnimationFrame(draw);
            }
            draw();
            
            // ì°½ í¬ê¸° ì¡°ì ˆ ëŒ€ì‘
            window.addEventListener('resize', () => {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            });
        }
    </script>
</body>
</html>
